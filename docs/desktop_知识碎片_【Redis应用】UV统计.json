{"data": "# \u3010Redis\u5e94\u7528\u3011UV\u7edf\u8ba1\n\n> \u4f5c\u8005\uff1a[.](https://blog.csdn.net/m0_66570338)\uff0c[\u7f16\u7a0b\u5bfc\u822a\u661f\u7403](https://wx.zsxq.com/dweb2/index/group/51122858222824) \u7f16\u53f7 6872\n\n> Redis\u5b9e\u73b0UV\u7edf\u8ba1\n\n## \u4e00.\u5f15\u5165\n\n\u9996\u5148\u6211\u4eec\u8981\u641e\u61c2\u4e24\u4e2a\u6982\u5ff5\uff1a\n\n- `UV`\uff1a\u5168\u79f0`Unique Visitor`\uff0c\u4e5f\u53eb**\u72ec\u7acb\u8bbf\u5ba2\u91cf**\uff0c\u662f\u6307\u901a\u8fc7\u4e92\u8054\u7f51\u8bbf\u95ee\u3001\u6d4f\u89c8\u8fd9\u4e2a\u7f51\u9875\u7684\u81ea\u7136\u4eba\u30021\u5929\u5185\u540c\u4e00\u4e2a\u7528\u6237\u591a\u6b21\u8bbf\u95ee\u8be5\u7f51\u7ad9\uff0c\u53ea\u8bb0\u5f551\u6b21\u3002\n- `PV`\uff1a\u5168\u79f0`Page View`\uff0c\u4e5f\u53eb**\u9875\u9762\u8bbf\u95ee\u91cf\u6216\u70b9\u51fb\u91cf**\uff0c\u7528\u6237\u6bcf\u8bbf\u95ee\u7f51\u7ad9\u7684\u4e00\u4e2a\u9875\u9762\uff0c\u8bb0\u5f551\u6b21PV\uff0c\u7528\u6237\u591a\u6b21\u6253\u5f00\u9875\u9762\uff0c\u5219\u8bb0\u5f55\u591a\u6b21PV\u3002\u5f80\u5f80\u7528\u6765\u8861\u91cf\u7f51\u7ad9\u7684\u6d41\u91cf\u3002\n\n\u901a\u5e38\u6765\u8bf4PV\u4f1a\u6bd4UV\u5927\u5f88\u591a\uff0c\u6240\u4ee5\u5f53\u6211\u4eec\u8981\u53bb\u8861\u91cf\u4e00\u4e2a\u7f51\u7ad9\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u9700\u8981\u7ed3\u5408\u591a\u4e2a\u503c\u4e00\u8d77\u6765\u5206\u6790\uff0c\u901a\u8fc7UV\u6211\u4eec\u53ef\u4ee5\u5f97\u77e5\u7f51\u7ad9\u7684\u8bbf\u5ba2\u91cf\uff0c\u901a\u8fc7PV\u6211\u4eec\u53ef\u4ee5\u5f97\u77e5\u9875\u9762\u7684\u8bbf\u95ee\u91cf\uff0c\u800c\u901a\u8fc7pv\u4e0euv\u7684\u6bd4\u503c\u6211\u4eec\u53ef\u4ee5\u5f97\u77e5\u7f51\u7ad9\u7684\u7528\u6237\u7c98\u5ea6\u3002\n\nUV\u7edf\u8ba1\u5728\u670d\u52a1\u7aef\u505a\u4f1a\u6bd4\u8f83\u9ebb\u70e6\uff0c\u56e0\u4e3a\u8981\u5224\u65ad\u8be5\u7528\u6237\u662f\u5426\u5df2\u7ecf\u7edf\u8ba1\u8fc7\u4e86\uff0c\u9700\u8981\u5c06\u7edf\u8ba1\u8fc7\u7684\u7528\u6237\u4fe1\u606f\u4fdd\u5b58\u3002\u4f46\u662f\u5982\u679c\u6bcf\u4e2a\u8bbf\u95ee\u7684\u7528\u6237\u90fd\u4fdd\u5b58\u5230Redis\u4e2d\uff0c\u6570\u636e\u91cf\u4f1a\u975e\u5e38\u6050\u6016\uff0c\u90a3\u600e\u4e48\u5904\u7406\u5462\uff1f\n\n## \u4e8c.HyperLogLog\u4f7f\u7528\n\n`Hyperloglog(HLL)`\u662f\u4eceLoglog\u7b97\u6cd5\u6d3e\u751f\u7684\u6982\u7387\u7b97\u6cd5\uff0c\u7528\u4e8e\u786e\u5b9a\u975e\u5e38\u5927\u7684\u96c6\u5408\u7684\u57fa\u6570\uff0c\u800c\u4e0d\u9700\u8981\u5b58\u50a8\u5176\u6240\u6709\u503c\u3002\u76f8\u5173\u7b97\u6cd5\u539f\u7406\u53ef\u4ee5\u53c2\u8003\uff1a[\u70b9\u51fb\u8df3\u8f6c](https://juejin.cn/post/6844903785744056333#heading-0)\u3002 Redis\u4e2d\u7684HLL\u662f\u57fa\u4e8estring\u7ed3\u6784\u5b9e\u73b0\u7684\uff0c\u5355\u4e2aHLL\u7684\u5185\u5b58**\u6c38\u8fdc\u5c0f\u4e8e16kb**\uff0c**\u5185\u5b58\u5360\u7528\u4f4e**\u7684\u4ee4\u4eba\u53d1\u6307\uff01\u4f5c\u4e3a\u4ee3\u4ef7\uff0c\u5176\u6d4b\u91cf\u7ed3\u679c\u662f\u6982\u7387\u6027\u7684\uff0c**\u6709\u5c0f\u4e8e0.81\uff05\u7684\u8bef\u5dee**\u3002\u4e0d\u8fc7\u5bf9\u4e8eUV\u7edf\u8ba1\u6765\u8bf4\uff0c\u8fd9\u5b8c\u5168\u53ef\u4ee5\u5ffd\u7565\u3002\n\n**\u5b83\u5bf9\u5e94\u7684\u547d\u4ee4\u6709\u4e09\u4e2a\uff1a** \n\n![](https://pic.yupi.icu/5563/202311171851679.png)\n\n \u5f53\u6211\u4eec\u4f7f\u7528`PFADD`\u547d\u4ee4\u6dfb\u52a0\u5143\u7d20\u65f6\u4ed6\u4f1a\u81ea\u52a8\u5e2e\u52a9\u6211\u4eec\u53bb\u9664\u91cd\u590d\u5143\u7d20\uff0c\u53ea\u7edf\u8ba1\u4e0d\u540c\u7684\u5143\u7d20\u4e2a\u6570\u3002\n\n## \u4e09.\u6a21\u62df\u5b9e\u73b0UV\u7edf\u8ba1\n\n\u7531\u4e8e\u6211\u4eec\u6ca1\u6709\u90a3\u4e48\u591a\u7684\u6d4b\u8bd5\u7528\u6237\uff0c\u6240\u4ee5\u6211\u4eec\u9009\u62e9\u5229\u7528\u5355\u5143\u6d4b\u8bd5\u6a21\u62df100\u4e07\u6b21\u7528\u6237\u8bbf\u95ee\u91cf\u3002\n\n\u6d4b\u8bd5\u601d\u8def\uff1a\u6211\u4eec\u76f4\u63a5\u5229\u7528\u5355\u5143\u6d4b\u8bd5\uff0c\u5411HyperLogLog\u4e2d\u6dfb\u52a0100\u4e07\u6761\u6570\u636e\uff0c\u770b\u770b\u5185\u5b58\u5360\u7528\u548c\u7edf\u8ba1\u6548\u679c\u5982\u4f55\n\n```java\n   // \u51c6\u5907\u6570\u7ec4\uff0c\u88c5\u586b\u7528\u6237\u6570\u636e\n        String[] users = new String[1000];\n        // \u6570\u7ec4\u89d2\u6807\n        int index = 0;\n        for (int i = 0; i < 1000000; i++) {\n            // \u8d4b\u503c\n            users[index++] = \"user_\" + i;\n            // \u6bcf1000\u6761\u53d1\u9001\u4ee5\u6b64\n            if (i % 1000 == 0) {\n                index = 0;\n                redisTemplate.opsForHyperLogLog().add(\"test\", users);\n            }\n        }\n        // \u7edf\u8ba1\u6570\u91cf\n        Long size = redisTemplate.opsForHyperLogLog().size(\"test\");\n        System.out.println(\"size=\" + size);\n```\n\n\u7ecf\u8fc7\u6d4b\u8bd5\uff1a\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u5b83\u786e\u5b9e\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u7edf\u8ba1UV\u5e76\u4e14\u5185\u5b58\u5360\u7528\u6781\u5c0f\uff0c\u4f46\u786e\u5b9e\u5b58\u5728\u4e00\u5b9a\u7684\u8bef\u5dee\uff0c\u4f46\u662f\u8bef\u5dee\u662f\u5728\u5141\u8bb8\u8303\u56f4\u5185\u7684\u3002\n\n![](https://pic.yupi.icu/5563/202311171851038.png)"}