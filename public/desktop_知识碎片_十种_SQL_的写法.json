{"data": "# \u5341\u79cd SQL \u7684\u5199\u6cd5\n\n> \u4f5c\u8005\uff1a[\u806a\u03b6](https://wx.zsxq.com/dweb2/index/footprint/185558512888212)\uff0c[\u7f16\u7a0b\u5bfc\u822a\u661f\u7403](https://wx.zsxq.com/dweb2/index/group/51122858222824) \u7f16\u53f7 12852\n\n\u5341\u79cdSQL\u7684\u8bed\u6cd5\n\n### \u4e00\u3001ORDER BY FIELD()\u81ea\u5b9a\u4e49\u6392\u5e8f\u903b\u8f91\n\nORDER BY FIELD(str,str1,...) \u81ea\u5b9a\u4e49\u6392\u5e8fsql\u5982\u4e0b\uff1a\n\n```sql\nSELECT * from order_diy ORDER BY FIELD(title,'\u4e5d\u9634\u771f\u7ecf', '\u964d\u9f99\u5341\u516b\u638c','\u4e5d\u9634\u767d\u9aa8\u722a','\u53cc\u624b\u4e92\u535a','\u6843\u82b1\u5c9b\u4e3b','\u5168\u771f\u5185\u529f\u5fc3\u6cd5','\u86e4\u87c6\u529f','\u9500\u9b42\u638c','\u7075\u767d\u5c71\u5c11\u4e3b');\n```\n\n![](https://pic.yupi.icu/5563/202311300832291.png)\n\n### \u4e8c\u3001CASE\u8868\u8fbe\u5f0f\n\n\u5047\u5982\u6211\u4eec\u60f3\u5728 order_diy \u8868\u52a0\u4e00\u5217 level \u5217\uff0c\u6839\u636emoney \u5224\u65ad\u5927\u4e8e60\u5c31\u662f\u9ad8\u7ea7\uff0c\u5927\u4e8e30\u5c31\u662f\u4e2d\u7ea7\uff0c\u5176\u4f59\u663e\u793a\u4f4e\u7ea7\uff0csql \u5982\u4e0b\uff1a\n\n```sql\nSELECT *, \ncase when money > 60 then '\u9ad8\u7ea7' \nwhen money > 30 then '\u4e2d\u7ea7' \nelse '\u4f4e\u7ea7' END level \nfrom order_diy;\n```\n\n![](https://pic.yupi.icu/5563/202311300832258.png)\n\n### \u4e09\u3001EXISTS\u7528\u6cd5\n\n\u53ef\u77e5 exists \u540e\u9762\u662f\u8ddf\u7740\u4e00\u4e2a\u5b50\u67e5\u8be2\u8bed\u53e5\uff0c\u5b83\u7684\u4f5c\u7528\u662f**\u6839\u636e\u4e3b\u67e5\u8be2\u7684\u6570\u636e\uff0c\u6bcf\u4e00\u884c\u90fd\u653e\u5230\u5b50\u67e5\u8be2\u4e2d\u505a\u6761\u4ef6\u9a8c\u8bc1\uff0c\u6839\u636e\u9a8c\u8bc1\u7ed3\u679c\uff08TRUE \u6216\u8005 FALSE\uff09\uff0cTRUE\u7684\u8bdd\u8be5\u884c\u6570\u636e\u5c31\u4f1a\u4fdd\u7559**\uff0c\u4e0b\u9762\u7528 emp \u8868\u548c dept \u8868\u8fdb\u884c\u4e3e\u4f8b\uff0c\u8868\u7ed3\u6784\u4ee5\u53ca\u6570\u636e\u5c55\u793a\uff1a\u8ba1\u5165\u6211\u4eec\u73b0\u5728\u60f3\u627e\u5230 emp \u8868\u4e2d dept_name \u4e0e dept\u8868 \u4e2d dept_name \u5bf9\u5e94\u4e0d\u4e0a\u5458\u5de5\u6570\u636e\uff0csql \u5982\u4e0b\uff1a\n\n```sql\nSELECT * from emp e where exists (\nSELECT * from dept p where e.dept_id = p.dept_id \nand e.dept_name != p.dept_name\n)\n```\n\n### \u56db\u3001GROUP CONCAT(expr)\u7ec4\u8fde\u63a5\u51fd\u6570\n\n**GROUP_CONCAT(expr)** \u7ec4\u8fde\u63a5\u51fd\u6570\u53ef\u4ee5\u8fd4\u56de\u5206\u7ec4\u540e\u6307\u5b9a\u5b57\u6bb5\u7684\u5b57\u7b26\u4e32\u8fde\u63a5\u5f62\u5f0f\uff0c\u5e76\u4e14\u53ef\u4ee5\u6307\u5b9a\u6392\u5e8f\u903b\u8f91\uff0c\u4ee5\u53ca\u8fde\u63a5\u5b57\u7b26\u4e32\uff0c\u9ed8\u8ba4\u4e3a\u82f1\u6587\u9017\u53f7\u8fde\u63a5\u3002\u8fd9\u91cc\u7ee7\u7eed\u7528 order_diy \u8868\u4e3e\u4f8b\uff1asql \u5982\u4e0b\uff1a\n\n```sql\nSELECT name, GROUP_CONCAT(title ORDER BY id desc  SEPARATOR '-') \nfrom order_diy GROUP BY name ORDER BY NULL;\n```\n\n![](https://pic.yupi.icu/5563/202311300832019.png)\n\n### \u4e94\u3001\u81ea\u8fde\u63a5\u67e5\u8be2\n\ntree \u8868\u4e2d\u901a\u8fc7 pid \u5b57\u6bb5\u4e0e id \u5b57\u6bb5\u8fdb\u884c\u7236\u5b50\u5173\u8054\uff0c\u5047\u5982\u73b0\u5728\u6709\u4e00\u4e2a\u9700\u6c42\uff0c\u6211\u4eec\u60f3\u6309\u7167\u7236\u5b50\u5c42\u7ea7\u5c06 tree \u8868\u6570\u636e\u8f6c\u6362\u6210 `\u4e00\u7ea7\u804c\u4f4d \u4e8c\u7ea7\u804c\u4f4d \u4e09\u7ea7\u804c\u4f4d` \u4e09\u4e2a\u5217\u540d\u8fdb\u884c\u5c55\u793a\uff0csql \u5982\u4e0b\uff1a\n\n```sql\nSELECT t1.job_name '\u4e00\u7ea7\u804c\u4f4d', t2.job_name '\u4e8c\u7ea7\u804c\u4f4d', t3.job_name '\u4e09\u7ea7\u804c\u4f4d' \nfrom tree t1 join tree t2 on t1.id = t2.pid left join tree t3 on t2.id = t3.pid \nwhere t1.pid = 0;\n```\n\n![](https://pic.yupi.icu/5563/202311300833035.png)\n\n### \u516d\u3001\u66f4\u65b0emp\u8868\u548cdept\u8868\u5173\u8054\u6570\u636e\n\n![](https://pic.yupi.icu/5563/202311300832139.png)\n\n\u53ef\u4ee5\u770b\u5230\u4e0a\u8ff0 emp \u8868\u4e2d jack \u7684\u90e8\u95e8\u540d\u79f0\u4e0e dept \u8868\u5b9e\u9645\u4e0d\u7b26\u5408\uff0c\u73b0\u5728\u6211\u4eec\u60f3\u5c06 jack \u7684\u90e8\u95e8\u540d\u79f0\u66f4\u65b0\u6210 dept \u8868\u7684\u6b63\u786e\u6570\u636e\uff0csql \u5982\u4e0b\uff1a\n\n```sql\nupdate emp, dept set emp.dept_name = dept.dept_name\nwhere emp.dept_id = dept.dept_id;\n```\n\n### \u4e03\u3001ORDER BY\u7a7a\u503cNULL\u6392\u5e8f\n\nORDER BY \u5b57\u53e5\u4e2d\u53ef\u4ee5\u8ddf\u6211\u4eec\u8981\u6392\u5e8f\u7684\u5b57\u6bb5\u540d\u79f0\uff0c\u4f46\u662f\u5f53\u5b57\u6bb5\u4e2d\u5b58\u5728 null \u503c\u65f6\uff0c\u4f1a\u5bf9\u6211\u4eec\u7684\u6392\u5e8f\u7ed3\u679c\u9020\u6210\u5f71\u54cd\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 **ORDER BY IF(ISNULL(title), 1, 0)** \u8bed\u6cd5\u5c06 null \u503c\u8f6c\u6362\u62100\u62161\uff0c\u6765\u8fbe\u5230\u5c06 null \u503c\u653e\u5230\u524d\u9762\u8fd8\u662f\u540e\u9762\u8fdb\u884c\u6392\u5e8f\u7684\u6548\u679c\u3002\u8fd9\u91cc\u7ee7\u7eed\u7528 order_diy \u8868\u4e3e\u4f8b\uff0csql \u5982\u4e0b\uff1a\n\n```sql\nSELECT * FROM order_diy ORDER BY  IF(ISNULL(title), 0, 1), money;\n```\n\n### \u516b\u3001with rollup\u5206\u7ec4\u7edf\u8ba1\u6570\u636e\u7684\u57fa\u7840\u4e0a\u518d\u8fdb\u884c\u7edf\u8ba1\u6c47\u603b\n\nMySql \u4e2d\u53ef\u4ee5\u4f7f\u7528 with rollup \u5728\u5206\u7ec4\u7edf\u8ba1\u6570\u636e\u7684\u57fa\u7840\u4e0a\u518d\u8fdb\u884c\u7edf\u8ba1\u6c47\u603b\uff0c\u5373\u7528\u6765\u5f97\u5230 group by \u7684\u6c47\u603b\u4fe1\u606f\u3002\u8fd9\u91cc\u7ee7\u7eed\u7528order_diy \u8868\u4e3e\u4f8b\uff0csql \u5982\u4e0b\uff1a\n\n```sql\nSELECT name, SUM(money) as money \nFROM order_diy GROUP BY name WITH ROLLUP;\n\u590d\u5236\u4ee3\u7801\n```\n\n\u67e5\u8be2\u7ed3\u679c\uff1a\n\n![](https://pic.yupi.icu/5563/202311300832962.png)\n\n\u53ef\u4ee5\u770b\u5230\u901a\u8fc7 **GROUP BY name WITH ROLLUP** \u8bed\u53e5\uff0c\u67e5\u8be2\u7ed3\u679c\u6700\u540e\u4e00\u5217\u663e\u793a\u4e86\u5206\u7ec4\u7edf\u8ba1\u7684\u6c47\u603b\u7ed3\u679c\u3002\u4f46\u662f name \u5b57\u6bb5\u6700\u540e\u663e\u793a\u4e3a null\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 `coalesce(val1, val2, ...)` \u51fd\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u4f1a\u8fd4\u56de\u53c2\u6570\u5217\u8868\u4e2d\u7684\u7b2c\u4e00\u4e2a\u975e\u7a7a\u53c2\u6570\u3002\n\n### \u4e5d\u3001with as \u63d0\u53d6\u4e34\u65f6\u8868\u522b\u540d\n\n\u5982\u679c\u4e00\u6574\u53e5\u67e5\u8be2\u4e2d**\u591a\u4e2a\u5b50\u67e5\u8be2\u90fd\u9700\u8981\u4f7f\u7528\u540c\u4e00\u4e2a\u5b50\u67e5\u8be2**\u7684\u7ed3\u679c\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u7528 with as\uff0c\u5c06\u5171\u7528\u7684\u5b50\u67e5\u8be2\u63d0\u53d6\u51fa\u6765\uff0c\u52a0\u4e2a\u522b\u540d\u3002\u540e\u9762\u67e5\u8be2\u8bed\u53e5\u53ef\u4ee5\u76f4\u63a5\u7528\uff0c\u5bf9\u4e8e\u5927\u91cf\u590d\u6742\u7684SQL\u8bed\u53e5\u8d77\u5230\u4e86\u5f88\u597d\u7684\u4f18\u5316\u4f5c\u7528\u3002\u8fd9\u91cc\u7ee7\u7eed\u7528 order_diy \u8868\u4e3e\u4f8b\uff0c\u8fd9\u91cc\u4f7f\u7528 with as \u7ed9\u51fa sql \u5982\u4e0b\uff1a\n\n```sql\n-- \u4f7f\u7528 with as\nwith t1 as (SELECT * from order_diy where money > 30),\nt2 as (SELECT * from order_diy where money > 60)\nSELECT * from t1 \nwhere t1.id not in (SELECT id from  t2) and t1.name = '\u5468\u4f2f\u901a';\n```\n\n![](https://pic.yupi.icu/5563/202311300832227.png)\n\n### \u5341\u3001\u5b58\u5728\u5c31\u66f4\u65b0\uff0c\u4e0d\u5b58\u5728\u5c31\u63d2\u5165\n\nMySql \u4e2d\u901a\u8fc7**on duplicate key update**\u8bed\u6cd5\u6765\u5b9e\u73b0\u5b58\u5728\u5c31\u66f4\u65b0\uff0c\u4e0d\u5b58\u5728\u5c31\u63d2\u5165\u7684\u903b\u8f91\u3002\u63d2\u5165\u6216\u8005\u66f4\u65b0\u65f6\uff0c\u5b83\u4f1a\u6839\u636e\u8868\u4e2d\u4e3b\u952e\u7d22\u5f15\u6216\u8005\u552f\u4e00\u7d22\u5f15\u8fdb\u884c\u5224\u65ad\uff0c\u5982\u679c\u4e3b\u952e\u7d22\u5f15\u6216\u8005\u552f\u4e00\u7d22\u5f15\u6709\u51b2\u7a81\uff0c\u5c31\u4f1a\u6267\u884c**on duplicate key update**\u540e\u9762\u7684\u8d4b\u503c\u8bed\u53e5\u3002 \u8fd9\u91cc\u901a\u8fc7 news \u8868\u4e3e\u4f8b\uff0c\u8868\u7ed3\u6784\u548c\u8bf4\u6570\u636e\u5c55\u793a\uff0c\u5176\u4e2d news_code \u5b57\u6bb5\u6709\u552f\u4e00\u7d22\u5f15\uff1a\n\n![](https://pic.yupi.icu/5563/202311300833894.png) \u6dfb\u52a0sql\uff1a\n\n```sql\n-- \u7b2c\u4e00\u6b21\u6267\u884c\u6dfb\u52a0\u8bed\u53e5\nINSERT INTO `news` (`news_title`, `news_auth`, `news_code`) \nVALUES ('\u65b0\u95fb3', '\u5c0f\u82b1', 'wx-0003') \non duplicate key update news_title = '\u65b0\u95fb3';\n-- \u7b2c\u4e8c\u6b21\u6267\u884c\u4fee\u6539\u8bed\u53e5\nINSERT INTO `news` (`news_title`, `news_auth`, `news_code`) \nVALUES ('\u65b0\u95fb4', '\u5c0f\u82b1', 'wx-0003') \non duplicate key update news_title = '\u65b0\u95fb4';\n```"}